syntax = "proto3";

package c1.connector.v2;

import "c1/config/v1/config.proto";
import "google/protobuf/any.proto";
import "google/protobuf/struct.proto";

option go_package = "github.com/conductorone/baton-sdk/pb/c1/connector/v2";

service ActionService {
  rpc InvokeAction(InvokeActionRequest) returns (InvokeActionResponse);
  rpc GetActionStatus(GetActionStatusRequest) returns (GetActionStatusResponse);
  rpc GetActionSchema(GetActionSchemaRequest) returns (GetActionSchemaResponse);
  rpc ListActionSchemas(ListActionSchemasRequest) returns (ListActionSchemasResponse);
}

enum BatonActionStatus {
  BATON_ACTION_STATUS_UNSPECIFIED = 0;
  BATON_ACTION_STATUS_UNKNOWN = 1;
  BATON_ACTION_STATUS_PENDING = 2;
  BATON_ACTION_STATUS_RUNNING = 3;
  BATON_ACTION_STATUS_COMPLETE = 4;
  BATON_ACTION_STATUS_FAILED = 5;
}

message BatonActionSchema {
  string name = 1;
  repeated c1.config.v1.Field arguments = 2;
  repeated c1.config.v1.Constraint constraints = 3;

  repeated c1.config.v1.Field return_types = 4;

  string display_name = 5;
  string description = 6;  
  repeated google.protobuf.Any traits = 7;
}

enum BatonLifeCycleManagementActionType {
  BATON_LIFE_CYCLE_MANAGEMENT_ACTION_TYPE_UNSPECIFIED = 0;
  BATON_LIFE_CYCLE_MANAGEMENT_ACTION_TYPE_NONE = 1;
  BATON_LIFE_CYCLE_MANAGEMENT_ACTION_TYPE_ENABLE = 2;
  BATON_LIFE_CYCLE_MANAGEMENT_ACTION_TYPE_DISABLE = 3;
  BATON_LIFE_CYCLE_MANAGEMENT_ACTION_TYPE_DELETE = 4;
  BATON_LIFE_CYCLE_MANAGEMENT_ACTION_TYPE_CREATE = 5;
}

message LifecycleManagementActionTrait {
  repeated BatonLifeCycleManagementActionType action_types = 1;
}

message InvokeActionRequest {
  string name = 1;
  google.protobuf.Struct args = 2;
  repeated google.protobuf.Any annotations = 3;
}

message InvokeActionResponse {
  string id = 1;
  BatonActionStatus status = 2;
  repeated google.protobuf.Any annotations = 3;
  google.protobuf.Struct response = 4;
  string name = 5;
}

message GetActionStatusRequest {
  string name = 1 [deprecated = true];
  string id = 2;
  repeated google.protobuf.Any annotations = 3;
}

message GetActionStatusResponse {
  string name = 1;
  string id = 2;
  BatonActionStatus status = 3;
  repeated google.protobuf.Any annotations = 4;
  google.protobuf.Struct response = 5;
}

message GetActionSchemaRequest {
  string name = 1;
  repeated google.protobuf.Any annotations = 2;
}

message GetActionSchemaResponse {
  BatonActionSchema schema = 1;
  repeated google.protobuf.Any annotations = 2;
}

message ListActionSchemasRequest {
  repeated google.protobuf.Any annotations = 1;  
  ActionSchemaFilter filter = 2;
}

message ActionSchemaFilter {
  ActionSchemaFilterType filter_type = 1;
}

enum ActionSchemaFilterType {
  ACTION_SCHEMA_FILTER_TYPE_UNSPECIFIED = 0;
  ACTION_SCHEMA_FILTER_TYPE_ALL = 1;
  ACTION_SCHEMA_FILTER_TYPE_WITH_LIFECYCLE_TRAIT = 2;
  ACTION_SCHEMA_FILTER_TYPE_WITHOUT_LIFECYCLE_TRAIT = 3;
}

message ListActionSchemasResponse {
  repeated BatonActionSchema schemas = 1;
  repeated google.protobuf.Any annotations = 2;
}
